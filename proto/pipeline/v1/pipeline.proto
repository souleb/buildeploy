syntax = "proto3";

package pipeline.v1;

option go_package = "github.com/souleb/buildeploy/proto/pipeline/v1";

//import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";

service PipelineService {
  rpc CreatePipeline(CreatePipelineRequest) returns (CreatePipelineResponse) {
		option (google.api.http) ={
			post: "/v1/pipeline"
			body: "item"
		};
	}
}

message CreatePipelineResponse {
  string id = 1;
}

message CreatePipelineRequest {
	Pipeline item = 1;
}

message Pipeline {
	string name = 1;
	repeated Workflow workflows = 2;
}

message Workflow {
	string name = 1;
	int32 id = 2;
	repeated Job jobs = 3;
	//google.protobuf.Timestamp created_at = 6;
	//google.protobuf.Timestamp updated_at = 7;
}

message Job {
	string name = 1;
	message Runner {
		oneof type {
			Docker docker = 1;
			Machine machine = 2;
		}
	}
	Runner runner = 2;
	Steps steps = 3;
	string env = 4;
	string branches = 5;
	repeated string needs = 6;
}

message Docker {
	string image = 1;
	string tags = 2;
}

message Machine {
	string os = 1;
	string cpus = 2;
	string memory = 3;
}

message Steps {
		repeated string command = 1;
}